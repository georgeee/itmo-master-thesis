\section{Поддержка умных контрактов}

\label{ch04-contracts}

\begin{definition}{Умный контракт}
 -- программа, определяемая в контексте некоторой блокчейн-системы, запускаемая в окружении, в котором ей доступны операции чтения и записи данных в состояние блокчейн-системы.
\end{definition}

Умные контракты были впервые предложены криптовалютой Ethereum \citep{eth-web} и на сегодняшний день является одной из наиболее распространенных функциональностей, реализуемых в новых блокчейн-системах. Они используются для реализации финансовых контрактов (многоступенчатых процедур, представляющих нетривиальную финансовую сделку между двумя и более участниками), равно и для реализации систем распределенных вычислений.

Блокчейн-система предоставляет некоторую виртуальную машину.
Примитивы виртуальной машины предоставляют как стандартные операции манипуляции с данным, контроля потока исполнения, так и специальные операции, позволяющие чтение произвольных данных, хранящихся в локальном состоянии узла системы, запись в состояние.

Контракты сохраняются в состоянии системы специальным типом транзакции, с контрактом ассоциируется область в адресном пространстве системы. Всякий раз когда в систему поступает транзакция, использующая адрес контракта, происходит выполнение контракта, в результате которого происходит подтверждение либо отклонение транзакции, а также возможно изменение некоторых других частей состояния.

Для реализации умных контрактов на основе предложенной модели блокчейн-системы следует использовать механизм дополнения транзакции. Контракт представляет собой функцию дополнения, которая по предложенному описанию транзакции генерирует список изменений состояния, которые должны произойти. 
Следует заметить, что умный контракт общего вида (как в частности контракты, использующиеся в системе Ethereum \citep{eth-web}) требуется исполнить для транзакции $tx_1$, чтобы перейти к валидации следующей
транзакции $tx_2$, как следствие параллелизация обработки множества транзакций в общем случае не представляется возможной. Однако дополнение транзакции общего вида полностью удовлетворяет задаче поддержки умных контрактов.

Следует также отметить, что прежде чем контракт будет запущен для входной транзакции и текущего состояния сети, невозможно узнать, какие изменения в состоянии породит применение контракта. Таким образом, изменения состояния, производимые контрактами, указываются неявно.
