\section {Консенсус-алгоритмы в блокчейн-системах}

Большинство алгоритмов консенсуса, разработанных для блокчейн-систем, являются алгоритмами для достижения в системе согласованности в конечном счете (англ. _eventual consistency_) или эвентуального консенсуса.
В отличие от классических алгоритмов консенсуса, таких как Paxos \citep{paxos} и Raft \citep {raft}, в блокчейн-системах от алгоритма консенсуса не требуется достижение полного консенсуса в системе. Вместо этого полагается достаточным достижение частичного консенсуса, переходящего в полный с вероятностью, увеличивающейся со временем с момента достижения согласия о некотором значении большинством узлов сети.

Первопроходцем среди распределенных систем, использующих структуру блокчейн по праву считается криптовалюта Bitcoin \citep{btc-web}.
В статье \emph{<<Bitcoin: A Peer-to-Peer Electronic Cash System>>} за авторством Satoshi Nakamoto \citep{btc}, описывающей концепцию децентрализованной системы электронных денег, предлагается использование метода доказательства выполнения работы (англ. _proof of work_) для построения алгоритма эвентуального консенсуса.
В оригинальной статье \citep{btc} предлагается алгоритм эвентуального консенсуса без подробного анализа. В последующих работах других авторов, в частности \emph{<<The bitcoin backbone protocol: Analysis and applications>>} \citep{btc-backbone-kiayias}, доказано что предложенный алгоритм (с небольшими модификациями) является толерантным к атакам, если как минимум 2/3 вычислительной мощности сети находится в управлении честных участников.

Метод доказательства выполнения работы был в дальнейшем применен для построения алгоритмов эвентуального консенсуса для систем Ethereum \citep{eth-web}, ZCash \citep{zcash-web}, IOTA \citep{iota-web}, равно как и множества других блокчейн-систем.

Другим популярным методом для построения консенсус-алгоритмов в блокчейн-системах является метод доказательства доли владения (англ. _proof of stake_), нашедший свое применение в построении алгоритмов эвентуального консенсуса Ouroboros \citep{ouroboros}, Snow White \citep{snowwhite}, алгоритмов для систем NXT \citep{nxt-web}, NEO \citep{neo-web}. Метод может быть также применен в построении алгоритмов полного консенсуса, в частности в алгоритме Algorand \citep{algorand}, также возможность
применения метода доказательства доли владения для разработки распределенных систем упомянута авторами алгоритма Honey Badger BFT \citep{hbbft}.

\subsection {Метод доказательства выполнения работы}

Алгоритмы консенсуса, реализующего метод доказательства выполнения работы, построены следующим образом: для выпуска нового блока $B_i$ участнику сети требуется найти некоторое целочисленное значение $nonce$, такое что значения $nonce$ и $B_i$ удовлетворяют булеву формулу, заданную функцией $f\; (x, y)$.
Функция приэтом может принимать самые разные формы, основное же условие на нее налагаемое -- сложность нахождения прообраза.

В случае системы Bitcoin \citep{btc} используется функция $f(nonce, \; block) \equiv hash \; ( nonce, \; block ) < 2^t$, причем порог $t$ динамически определяется в зависимости от текущего состояния системы. А именно, порог $t$ выбирается на основе статистики последних выпущенных блоков таким образом, чтобы сохранять среднюю частоту выпуска блоков равной десяти минутам.

Сложность выпуска блоков минимизирует вероятность ситуации, когда два блока оказываются выпущенными одновременно и требуется достижение консенсуса относительно того, какой блок будет принят системой. В случае возникновения такой ситуации, цепочка блоков, поддерживаемая сетью, разделяется на две. В таком случае применяется правило предпочтения более длинной цепочки.
Доказывается \citep{btc-backbone-kiayias}, что вероятность того, что обе цепочки будут поддерживаться в течении времени $T$, экспоненциально убывает с ростом значения $T$. Это показывает корректность алгоритма в достижении эвентуального консенсуса.
Общая корректность алгоритма доказывается в предположении о том, что больше половины вычислительной мощности системы (англ. _hashing power_) находится под контролем честных игроков.

Все алгоритмы консенсуса, реализующие метод доказательства выполнения работы, являются чрезвычайно неэффективными с точки зрения использования вычислительных ресурсов.
Сложность нахождения прообраза функции $f$ является частью дизайна данных алгоритмов. Предполагается, что единственным способом нахождения подходящего значения $nonce$ для удовлетворения булевой функции $f$ является перебор широкого спектра случайных значений.
В случае развитой сети, в которой множество игроков соревнуются за право выпуска блока, это приводит к необходимости перебора миллионов значений для выпуска одного блока, что оказывает непосредственное влияние на затраты электроэнергии, накладываемые используемым протоколом, и как следствие -- на стоимость обработки транзакций в сети, что также негативно влияет на конкурентоспособность системы в целом.

\subsection {Метод доказательства доли владения}

\label{ch01-pos}

Метод доказательства доли владения основывается на идее о том, что участниками, наиболее заинтересованными в корректной работе сети, являются участники, владеющие наибольшими долями сети. Каждому участнику сети $i$ сопоставлено некоторое значение, называемое его долей владения $stake_i \in [0..1]$, причем $\sum_i stake_i = 1$. Право выпуска блока участником $i$ в каждый момент времени определяется величиной его доли владения $stake_i$ и статистикой последних выпущенных блоков.
Основная идея, применяемая во всех алгоритмах консенсуса, использующих метод доказательства доли владения, состоит в том, что вероятность выпуска блока участником $i$ в среднем за некоторый достаточно большой период равна значению его доли владения.

Следует заметить, что значения долей владения могут динамически изменяться со временем. Более того, как правило они непосредственно сассоциированы со значениями балансов участников системы. Таким образом, каждая транзакция, совершенная в системе, в конечном итоге влияет на значения долей владения. Существует множество конструктивных сложностей в построении алгоритмов консенсуса, реализующих метод доказательства доли владения.
Для алгоритмов консенсуса, предложенных создателями систем Peercoin \citep{ppc-white}, NXT \citep{nxt-web} позже были предложены эффективные методы атак, использующие уязвимости в дизайне алгоритмов и позволяющих злоумышленнику получить больший контроль над системой в сравнении с его реальным значением доли владения.

В 2016 и 2017 годах был предложен ряд алгоритмов консенсуса, для которых была доказана устойчивость по отношению ко всем известным на момент публикации атакам: Ouroboros \citep{ouroboros}, Snowwhite \citep{snowwhite}, Algorand \citep{algorand}. Разработка доказанно безопасных алгоритмов консенсуса на основе метода доказательства доли владения являтся значительным достижением, поощряющим использование алгоритмов, реализующих метод в построении систем, имеющих практическое применение.
Корректность алгоритмов доказывается в предположении о том, что суммарно под контролем честных игроков находится более 50% доли владения системой.

Алгоритмы консенсуса, реализующие метод доказательства доли владения, являются несравнимо более эффективными с точки зрения использования вычислительных ресурсов. Выпуск одного блока требует фиксированного числа (самое большее, десятков) операций вычисления хэш-функции. Количество операций, производимых при поддержке алгоритмов консенсуса, реализующих метод доказательства выполнения работы, теоретически неограничено.
